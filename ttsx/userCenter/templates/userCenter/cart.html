{% extends 'base.html' %}
{% load staticfiles %}
{% block title %}
天天生鲜-购物车
{% endblock %}


{% block head %}
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<link rel="stylesheet" type="text/css" href="{%static 'css/reset.css'%}">
	<link rel="stylesheet" type="text/css" href="{%static 'css/main.css'%}">
    <script type="text/javascript", src="{% static 'jss/jquery-1.12.4.min.js' %}"></script>
    <script type="text/javascript">
    $(function () {
        {#当+按下后，调用函数，改变数量、小计、总计#}
        $(".add").click(function () {
            var obj = $(this)
            add1(obj)
            total()
        })
        {#当-按下后，调用函数，改变数量、小计、总计#}
        $(".minus").click(function () {
            var obj = $(this)
            sub1(obj)
            total()
        })
        {#当删除操作时，将此商品删除#}
        $(".col08").click(function () {
            $(this).parent().remove()
            total()
        })
        {#当商品复选框发生变化时，计算总价，改变全选复选框的状态#}
        $(".cart_list_td .col01 input").change(function () {
           total()
           var Flag = true
           $(".cart_list_td .col01 input").each(function() {
                if($(this).is(':checked')){
                    Flag = true
                }
                else{
                    Flag = false
                    $(".settlements .col01 input").prop("checked",false)
                    return false
                }
            })
            if(Flag){
                $(".settlements .col01 input").prop("checked",true)
            }
        })
        {#当全选复选框发生变化时，改变商品复选框状态#}
        $(".settlements .col01 input").change(function () {
            if($(this).is(':checked')){
                $(".cart_list_td .col01 input").each(function() {
                    $(this).prop("checked",true)
                })
            }
            else{
                $(".cart_list_td .col01 input").each(function() {
                    $(this).prop("checked",false)
                })
            }
            total()
        })
    });
    {#定义添加函数，当按下+时，数量显示值+1，同时，计算小计.click事件发生时，调用此函数.#}
    function add1(obj) {
        num = obj.siblings(".num_show").val()
        obj.siblings(".num_show").val(num*1+1)
        price = parseFloat(obj.parents("ul").children(".col05").text())
        num = obj.siblings(".num_show").val()
        subtotal = num*price+'元'
        obj.parents("ul").children(".col07").text(subtotal)
    };
    {#定义减少函数，当按下-时，数量显示值-1。当值为1时不再减  #}
    function sub1(obj) {
        num = parseFloat(obj.siblings(".num_show").val())
            if (num>1) {
                obj.siblings(".num_show").val(num - 1)
                price = parseFloat(obj.parents("ul").children(".col05").text())
                num = obj.siblings(".num_show").val()
                subtotal = num * price + '元'
                obj.parents("ul").children(".col07").text(subtotal)
                }
    };
    {#定义计算总价及总计函数，首先判断复选框是否选中，当复选框选中时纳入计算。遍历所有商品复选框，当选中时，分别计算将价格和数量相加#}
    function total() {
        var total = 0.0
        var num = 0.0
        $(".cart_list_td .col01 input").each(function () {
            if($(this).is(':checked')){
                total = total+parseFloat($(this).parents("ul").children(".col07").text())
                num = num+parseFloat($(this).parents("ul").find(".num_show").val())
            }
        })
        $(".settlements .col03 em").text(total)
        $(".settlements .col03 b").text(num)
    };
    </script>
{% endblock %}


{% block content %}
<div class="search_bar clearfix">
		<a href="index.html" class="logo fl"><img src="{% static 'images/logo.png'%}"></a>
		<div class="sub_page_name fl">|&nbsp;&nbsp;&nbsp;&nbsp;购物车</div>
		<div class="search_con fr">
			<form action="{% url 'shopping:search' 'id' 1%}" method="get">
			<input type="text" class="input_text fl" name="search_good" id="search_text" placeholder="搜索商品">
			<input type="submit" class="input_btn fr" id="search_button" value="搜索">
            <p><span id='search_result'></span></p>
            </form>
		</div>
	</div>

	<div class="total_count">全部商品<em>2</em>件</div>
	<ul class="cart_list_th clearfix">
		<li class="col01">商品名称</li>
		<li class="col02">商品单位</li>
		<li class="col03">商品价格</li>
		<li class="col04">数量</li>
		<li class="col05">小计</li>
		<li class="col06">操作</li>
	</ul>
	<ul class="cart_list_td clearfix">
		<li class="col01"><input type="checkbox" name="" checked></li>
		<li class="col02"><img src="/data/images/goods/goods012.jpg"></li>
		<li class="col03">奇异果<br><em>25.80元/500g</em></li>
		<li class="col04">500g</li>
		<li class="col05">25.8元</li>
		<li class="col06">
			<div class="num_add">
				<a href="javascript:;" class="add fl">+</a>
				<input type="text" class="num_show fl" value="1">
				<a href="javascript:;" class="minus fl">-</a>
			</div>
		</li>
		<li class="col07" id="subtotal">25.80元</li>
		<li class="col08"><a href="javascript:;">删除</a></li>
	</ul>


    <ul class="cart_list_td clearfix">
		<li class="col01"><input type="checkbox" name="" checked></li>
		<li class="col02"><img src="/data/images/goods/goods003.jpg"></li>
		<li class="col03">大兴大棚草莓<br><em>16.80元/500g</em></li>
		<li class="col04">500g</li>
		<li class="col05" id="price">16.80元</li>
		<li class="col06">
			<div class="num_add">
				<a href="javascript:;" class="add fl">+</a>
				<input type="text" class="num_show fl" value="1">
				<a href="javascript:;" class="minus fl">-</a>
			</div>
		</li>
		<li class="col07">16.80元</li>
		<li class="col08"><a href="javascript:;">删除</a></li>
	</ul>


	<ul class="settlements">
		<li class="col01"><input type="checkbox" name="" checked=""></li>
		<li class="col02">全选</li>
		<li class="col03">合计(不含运费)：<span>¥</span><em>42.60</em><br>共计<b>2</b>件商品</li>
		<li class="col04"><a href="place_order.html">去结算</a></li>
	</ul>
{% endblock %}